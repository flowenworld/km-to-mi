<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn-icons-png.flaticon.com/512/189/189688.png" rel="icon" type="image/png"/>
    <title id="dynamicTitle">KM to Miles Converter</title>
    <meta content="Easily convert kilometers to miles with our fast, accurate online tool." id="metaDescription" name="description"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>

    <!-- Styles remain unchanged -->
    <style>
    /* ... (keeping all your existing styles) ... */
    </style>
</head>
<body>
    <div class="main-content">
        <div class="header">
            <h1><a href="?" onclick="navigateTo('?'); return false;">KM to Miles Converter</a></h1>
            <nav>
                <a href="?page=sitemap" onclick="navigateTo('?page=sitemap'); return false;">Sitemap</a>
            </nav>
        </div>
        <div class="card calculator">
            <input id="inputValue" placeholder="Enter KM (e.g., 10)" type="number"/>
            <button onclick="convertKmToMiles()">Convert</button>
            <div class="result" id="result"></div>
        </div>
        <div class="card" id="gridContainer">
            <div class="grid"></div>
        </div>
        <div class="card sitemap" id="sitemapContainer" style="display: none;">
            <h3>Sitemap Preview (1-1000 KM)</h3>
            <pre id="sitemap"></pre>
            <button onclick="downloadSitemap()">Download Sitemap.xml</button>
        </div>
        <div class="card" id="detailedContent" style="display: none;">
            <div class="table-container">
                <h3>Nearby Conversions</h3>
                <table class="table" id="kmToMilesTable">
                    <thead>
                        <tr>
                            <th>KM</th>
                            <th>Miles</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="formula">
                <h3>How It Works</h3>
                <p>Multiply kilometers by 0.621371 to get miles.</p>
            </div>
            <div class="steps">
                <h3>Conversion Steps</h3>
                <p id="stepExplanation"></p>
            </div>
            <div class="explanation">
                <h3>Why It Matters</h3>
                <p id="explanationText"></p>
            </div>
        </div>
        <div class="footer">
            <p>© 2025 KM to Miles Converter. All rights reserved.</p>
        </div>
    </div>

    <script>
    function updatePageMetadata(km) {
        const titleElement = document.getElementById('dynamicTitle');
        const metaDescription = document.getElementById('metaDescription');
        
        if (km !== null && !isNaN(km) && km !== '') {
            document.title = `${km} KM to Miles Converter`;
            titleElement.textContent = `${km} KM to Miles Converter`;
            if (metaDescription) {
                metaDescription.setAttribute('content', `Convert ${km} kilometers to miles instantly with our easy-to-use tool.`);
            }
        } else {
            document.title = 'KM to Miles Converter';
            titleElement.textContent = 'KM to Miles Converter';
            if (metaDescription) {
                metaDescription.setAttribute('content', 'Easily convert kilometers to miles with our fast, accurate online tool.');
            }
        }
    }

    function getBaseUrl() {
        return window.location.origin;
    }

    function navigateTo(query) {
        window.history.pushState({}, document.title, query);
        renderPage();
    }

    function getQueryParams() {
        const params = new URLSearchParams(window.location.search);
        return {
            km: params.get('km'),
            page: params.get('page')
        };
    }

    function generateFullSitemap() {
        const baseUrl = getBaseUrl();
        const currentDate = new Date().toISOString().split('T')[0];
        
        let sitemap = '<?xml version="1.0" encoding="UTF-8"?>\n';
        sitemap += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n';
        
        sitemap += '  <url>\n';
        sitemap += `    <loc>${baseUrl}/</loc>\n`;
        sitemap += `    <lastmod>${currentDate}</lastmod>\n`;
        sitemap += '    <changefreq>daily</changefreq>\n';
        sitemap += '    <priority>1.0</priority>\n';
        sitemap += '  </url>\n';
        
        sitemap += '  <url>\n';
        sitemap += `    <loc>${baseUrl}/?page=sitemap</loc>\n`;
        sitemap += `    <lastmod>${currentDate}</lastmod>\n`;
        sitemap += '    <changefreq>monthly</changefreq>\n';
        sitemap += '    <priority>0.5</priority>\n';
        sitemap += '  </url>\n';
        
        for (let i = 1; i <= 1000; i++) {
            const url = `${baseUrl}/?km=${i}`;
            sitemap += '  <url>\n';
            sitemap += `    <loc>${url}</loc>\n`;
            sitemap += `    <lastmod>${currentDate}</lastmod>\n`;
            sitemap += '    <changefreq>monthly</changefreq>\n';
            sitemap += '    <priority>0.8</priority>\n';
            sitemap += '  </url>\n';
        }
        
        sitemap += '</urlset>';
        return sitemap;
    }

    function generateSitemapPreview() {
        const sitemapContent = generateFullSitemap();
        document.getElementById("sitemap").textContent = sitemapContent;
    }

    function downloadSitemap() {
        const sitemapContent = generateFullSitemap();
        const blob = new Blob([sitemapContent], { type: 'text/xml' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'sitemap.xml';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function renderPage() {
        const { km, page } = getQueryParams();
        const gridContainer = document.getElementById('gridContainer');
        const detailedContent = document.getElementById('detailedContent');
        const sitemapContainer = document.getElementById('sitemapContainer');

        const kmValue = km ? parseFloat(km) : null;

        if (!km && !page) {
            gridContainer.style.display = 'block';
            sitemapContainer.style.display = 'none';
            detailedContent.style.display = 'none';
            generateConversionGrid();
            updatePageMetadata(null);
        } else if (page === 'sitemap') {
            gridContainer.style.display = 'none';
            detailedContent.style.display = 'none';
            sitemapContainer.style.display = 'block';
            generateSitemapPreview();
            updatePageMetadata(null);
        } else if (!isNaN(kmValue)) {
            gridContainer.style.display = 'none';
            sitemapContainer.style.display = 'none';
            detailedContent.style.display = 'block';
            updatePageMetadata(kmValue);
            showDetailedConversion(kmValue);
        } else {
            navigateTo('?');
        }
    }

    function generateConversionGrid() {
        const grid = document.querySelector('.grid');
        grid.innerHTML = '';
        for (let i = 1; i <= 500; i += 10) {
            const gridItem = document.createElement('div');
            gridItem.className = 'grid-item';
            gridItem.innerHTML = `<a href="?km=${i}" onclick="navigateTo('?km=${i}'); return false;">${i} KM To MI</a>`;
            grid.appendChild(gridItem);
        }
    }

    function showDetailedConversion(km) {
        const inputValue = document.getElementById('inputValue');
        const resultDiv = document.getElementById('result');
        inputValue.value = km;
        const miles = km * 0.621371;
        resultDiv.innerHTML = `${km} KM equals ${miles.toFixed(2)} miles`;

        const tableBody = document.querySelector('#kmToMilesTable tbody');
        tableBody.innerHTML = '';
        for (let i = 1; i <= 9; i++) {
            const incrementalValue = km + (i / 10);
            const convertedValue = incrementalValue * 0.621371;
            tableBody.innerHTML += `<tr><td>${incrementalValue.toFixed(1)}</td><td>${convertedValue.toFixed(2)}</td></tr>`;
        }

        document.getElementById('stepExplanation').innerHTML = `
            1. Take ${km} kilometers.<br>
            2. Multiply by 0.621371.<br>
            3. You will get ${miles.toFixed(2)} miles.
        `;

        document.getElementById('explanationText').innerHTML = `
            Switching from kilometers to miles is quick and easy! Start with ${km} KM, multiply by 0.621371 (the magic number for this conversion), and you’ll land on ${miles.toFixed(2)} miles.
        `;
    }

    function convertKmToMiles() {
        const km = parseFloat(document.getElementById('inputValue').value);
        if (!isNaN(km) && km > 0) {
            navigateTo(`?km=${km}`);
        } else {
            document.getElementById('result').innerHTML = 'Please enter a valid number greater than 0.';
        }
    }

    window.addEventListener('popstate', renderPage);
    window.addEventListener('load', () => {
        renderPage();
    });

    // Initial render
    renderPage();
    </script>
</body>
</html>
